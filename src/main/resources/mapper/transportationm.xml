<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="transportationm">
    <insert id="insert" parameterType="java.util.Map">
        insert into TransportationM
        (
        publish_id,
        weight,
        qty,
        amount,
        create_date,
        company_id,
        start_plate,
        end_plate,
        get_order_plate,
        create_person,
        platform_id,
        company_name,
        prod_desc,
        price,
        pickup_date,
        sender,
        sender_mobile,
        receiver,
        receiver_mobile,
        bill_sender,
        bill_sender_mobile,
        bill_taker,
        bill_taker_mobile,
        init_amount,
        init_qty,
        init_weight,
        status,
        departure ,
        departure_lng ,
        departure_lat ,
        destination ,
        destination_lng ,
        destination_lat ,
        get_order_address,
        get_order_address_lng,
        get_order_address_lat,
        good_type,
        good_type_desc,
        publish_company_id,
        operate_type,
        update_date,
        fd_user_id,
        if_can_show,
        update_person,
        if_feidan,
        pri_publish_id,
        standard_tax,
        price_tax,
        if_tax_transport,
        vat_flow_master_id,
        carry_company_id,
        group_id,
        group_name,
        owner_adjust_flag,
        owner_adjust_type,
        owner_adjust_amt,
        good_price,
        loss_type,
        loss_ratio,
        loss_weight
        )
        select a.publish_id,
        #{grabWeight},
        #{grabQty},
        round(#{grabWeight} * #{outPrice} ,2),
        now(),
        #{companyId},
        a.start_plate,
        a.end_plate,
        a.get_order_plate,
        #{userId},
        #{platformId},
        #{companyName},
        a.prod_desc,
        #{outPrice},
        a.pickup_date,
        a.sender,
        a.sender_mobile,
        a.receiver,
        a.receiver_mobile,
        a.bill_sender,
        a.bill_sender_mobile,
        a.bill_taker,
        a.bill_taker_mobile,
        round(#{grabWeight} * #{outPrice} ,2),
        #{grabQty},
        #{grabWeight},
        '20',
        a.departure ,
        a.departure_lng ,
        a.departure_lat ,
        a.destination ,
        a.destination_lng ,
        a.destination_lat ,
        a.get_order_address,
        a.get_order_address_lng,
        a.get_order_address_lat,
        a.good_type,
        a.good_type_desc,
        a.company_id,
        'WEB',
        now(),
        a.fd_user_id,
        a.if_can_show,
        #{userId},
        #{ifFly},
        a.pri_publish_id,
        #{standardTax},
        #{priceTax},
        #{ifTaxTransport},
        #{vatFlowMasterId},
        if(#{ifTaxTransport} = 'Y', (SELECT t.vat_carry_id FROM apptms.vatflowdetail t where t.vat_flow_master_id = #{vatFlowMasterId} and t.if_begin = 'Y'), #{companyId}),
        a.group_id,
        a.group_name,
        a.owner_adjust_flag,
        a.owner_adjust_type,
        a.owner_adjust_amt,
        a.good_price,
        a.loss_type,
        a.loss_ratio,
        a.loss_weight
        from GoodsOrderM a
        where a.publish_id = #{publishId}
        <selectKey keyProperty="transId" resultType="java.lang.Long" order="AFTER">
            SELECT LAST_INSERT_ID() as transId
        </selectKey>
    </insert>

</mapper>